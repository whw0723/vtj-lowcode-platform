<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIè°ƒè¯•æµ‹è¯•</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        button {
            background-color: #409eff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #66b1ff;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #409eff;
        }
        .error {
            border-left-color: #f56c6c;
            background-color: #fef0f0;
        }
        .success {
            border-left-color: #67c23a;
            background-color: #f0f9ff;
        }
        pre {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.success { background-color: #67c23a; color: white; }
        .status.error { background-color: #f56c6c; color: white; }
        .status.warning { background-color: #e6a23c; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>APIè°ƒè¯•æµ‹è¯•é¡µé¢</h1>
        <p>ç”¨äºæµ‹è¯•ç‰©æµç›¸å…³APIçš„å®é™…è¿”å›æ•°æ®ç»“æ„</p>

        <!-- åŒ»é™¢æ•°æ®æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ¥ åŒ»é™¢æ•°æ®APIæµ‹è¯•</h3>
            <p><strong>æ¥å£:</strong> POST /Manage/Hospital/GetCacheHospitalData</p>
            <button onclick="testHospitalApi()">æµ‹è¯•åŒ»é™¢API</button>
            <div id="hospital-result" class="result" style="display: none;">
                <div id="hospital-status"></div>
                <pre id="hospital-response"></pre>
            </div>
        </div>

        <!-- å¿«é€’ç±»å‹æ•°æ®æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸšš å¿«é€’ç±»å‹APIæµ‹è¯•</h3>
            <p><strong>æ¥å£:</strong> POST /Manage/PreScription/GetExpressTypeDataByCache</p>
            <button onclick="testExpressTypeApi()">æµ‹è¯•å¿«é€’ç±»å‹API</button>
            <div id="express-result" class="result" style="display: none;">
                <div id="express-status"></div>
                <pre id="express-response"></pre>
            </div>
        </div>

        <!-- ç‰©æµæ•°æ®æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ“¦ ç‰©æµæ•°æ®APIæµ‹è¯•</h3>
            <p><strong>æ¥å£:</strong> POST /Manage/Logistics/GetLogisticsToday</p>
            <button onclick="testLogisticsApi()">æµ‹è¯•ç‰©æµAPI</button>
            <div id="logistics-result" class="result" style="display: none;">
                <div id="logistics-status"></div>
                <pre id="logistics-response"></pre>
            </div>
        </div>

        <!-- ç½‘ç»œè¿æ¥æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸŒ ç½‘ç»œè¿æ¥æµ‹è¯•</h3>
            <p>æµ‹è¯•åˆ°åç«¯æœåŠ¡å™¨çš„è¿æ¥</p>
            <button onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
            <div id="connection-result" class="result" style="display: none;">
                <div id="connection-status"></div>
                <pre id="connection-response"></pre>
            </div>
        </div>
    </div>

    <script>
        // é…ç½®axios
        axios.defaults.withCredentials = true;
        axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';

        // æ˜¾ç¤ºç»“æœçš„é€šç”¨å‡½æ•°
        function showResult(prefix, success, data, error = null) {
            const resultDiv = document.getElementById(`${prefix}-result`);
            const statusDiv = document.getElementById(`${prefix}-status`);
            const responseDiv = document.getElementById(`${prefix}-response`);
            
            resultDiv.style.display = 'block';
            
            if (success) {
                resultDiv.className = 'result success';
                statusDiv.innerHTML = '<span class="status success">SUCCESS</span> APIè°ƒç”¨æˆåŠŸ';
                responseDiv.textContent = JSON.stringify(data, null, 2);
            } else {
                resultDiv.className = 'result error';
                statusDiv.innerHTML = '<span class="status error">ERROR</span> APIè°ƒç”¨å¤±è´¥';
                responseDiv.textContent = error ? JSON.stringify(error, null, 2) : 'æœªçŸ¥é”™è¯¯';
            }
        }

        // æµ‹è¯•åŒ»é™¢API
        async function testHospitalApi() {
            console.log('ğŸ¥ æµ‹è¯•åŒ»é™¢API...');
            try {
                const response = await axios.post('/Manage/Hospital/GetCacheHospitalData', {});
                console.log('åŒ»é™¢APIå“åº”:', response);
                
                // æ˜¾ç¤ºå®Œæ•´å“åº”ä¿¡æ¯
                const responseInfo = {
                    status: response.status,
                    statusText: response.statusText,
                    headers: response.headers,
                    data: response.data
                };
                
                showResult('hospital', true, responseInfo);
                
                // åˆ†ææ•°æ®ç»“æ„
                if (response.data && typeof response.data === 'object') {
                    console.log('âœ… æ•°æ®ç±»å‹:', typeof response.data);
                    console.log('âœ… æ•°æ®é”®:', Object.keys(response.data));
                    if (response.data.code) {
                        console.log('âœ… å“åº”ç :', response.data.code);
                    }
                    if (response.data.data) {
                        console.log('âœ… æ•°æ®ç»“æ„:', typeof response.data.data);
                        if (response.data.data.itemlist) {
                            console.log('âœ… åŒ»é™¢åˆ—è¡¨é•¿åº¦:', response.data.data.itemlist.length);
                        }
                    }
                }
            } catch (error) {
                console.error('âŒ åŒ»é™¢APIæµ‹è¯•å¤±è´¥:', error);
                showResult('hospital', false, null, {
                    message: error.message,
                    status: error.response?.status,
                    statusText: error.response?.statusText,
                    data: error.response?.data
                });
            }
        }

        // æµ‹è¯•å¿«é€’ç±»å‹API
        async function testExpressTypeApi() {
            console.log('ğŸšš æµ‹è¯•å¿«é€’ç±»å‹API...');
            try {
                const response = await axios.post('/Manage/PreScription/GetExpressTypeDataByCache', {});
                console.log('å¿«é€’ç±»å‹APIå“åº”:', response);
                
                // æ˜¾ç¤ºå®Œæ•´å“åº”ä¿¡æ¯
                const responseInfo = {
                    status: response.status,
                    statusText: response.statusText,
                    headers: response.headers,
                    data: response.data
                };
                
                showResult('express', true, responseInfo);
                
                // åˆ†ææ•°æ®ç»“æ„
                if (response.data && typeof response.data === 'object') {
                    console.log('âœ… æ•°æ®ç±»å‹:', typeof response.data);
                    console.log('âœ… æ•°æ®é”®:', Object.keys(response.data));
                    if (response.data.code) {
                        console.log('âœ… å“åº”ç :', response.data.code);
                    }
                    if (response.data.data) {
                        console.log('âœ… æ•°æ®ç»“æ„:', typeof response.data.data);
                        if (Array.isArray(response.data.data)) {
                            console.log('âœ… å¿«é€’ç±»å‹æ•°é‡:', response.data.data.length);
                        }
                    }
                }
            } catch (error) {
                console.error('âŒ å¿«é€’ç±»å‹APIæµ‹è¯•å¤±è´¥:', error);
                showResult('express', false, null, {
                    message: error.message,
                    status: error.response?.status,
                    statusText: error.response?.statusText,
                    data: error.response?.data
                });
            }
        }

        // æµ‹è¯•ç‰©æµAPI
        async function testLogisticsApi() {
            console.log('ğŸ“¦ æµ‹è¯•ç‰©æµAPI...');
            try {
                const params = new URLSearchParams({
                    page: '1',
                    limit: '20',
                    hospital: '0',
                    logisticsselect: '',
                    searchcontent: '',
                    logisticsptype: '',
                    quertime: '',
                    logistictime: '',
                    decmothed: '-1'
                });

                const response = await axios.post('/Manage/Logistics/GetLogisticsToday', params);
                console.log('ç‰©æµAPIå“åº”:', response);
                
                // æ˜¾ç¤ºå®Œæ•´å“åº”ä¿¡æ¯
                const responseInfo = {
                    status: response.status,
                    statusText: response.statusText,
                    headers: response.headers,
                    data: response.data
                };
                
                showResult('logistics', true, responseInfo);
                
                // åˆ†ææ•°æ®ç»“æ„
                if (response.data && typeof response.data === 'object') {
                    console.log('âœ… æ•°æ®ç±»å‹:', typeof response.data);
                    console.log('âœ… æ•°æ®é”®:', Object.keys(response.data));
                    if (response.data.code) {
                        console.log('âœ… å“åº”ç :', response.data.code);
                    }
                    if (response.data.data) {
                        console.log('âœ… æ•°æ®ç»“æ„:', typeof response.data.data);
                        if (Array.isArray(response.data.data)) {
                            console.log('âœ… ç‰©æµæ•°æ®æ•°é‡:', response.data.data.length);
                        }
                    }
                    if (response.data.count) {
                        console.log('âœ… æ€»æ•°é‡:', response.data.count);
                    }
                }
            } catch (error) {
                console.error('âŒ ç‰©æµAPIæµ‹è¯•å¤±è´¥:', error);
                showResult('logistics', false, null, {
                    message: error.message,
                    status: error.response?.status,
                    statusText: error.response?.statusText,
                    data: error.response?.data
                });
            }
        }

        // æµ‹è¯•ç½‘ç»œè¿æ¥
        async function testConnection() {
            console.log('ğŸŒ æµ‹è¯•ç½‘ç»œè¿æ¥...');
            try {
                // æµ‹è¯•ä»£ç†æ˜¯å¦å·¥ä½œ
                const response = await axios.get('/Manage/test', {
                    timeout: 5000,
                    validateStatus: function (status) {
                        return status < 500; // åªæœ‰5xxé”™è¯¯æ‰ç®—å¤±è´¥
                    }
                });
                
                console.log('è¿æ¥æµ‹è¯•å“åº”:', response);
                
                const connectionInfo = {
                    status: response.status,
                    statusText: response.statusText,
                    proxyWorking: response.status !== 404 || response.data.includes('æœåŠ¡å™¨é”™è¯¯'),
                    message: response.status === 404 ? 'ä»£ç†å·¥ä½œæ­£å¸¸ï¼Œä½†æ¥å£ä¸å­˜åœ¨' : 'è¿æ¥æˆåŠŸ'
                };
                
                showResult('connection', true, connectionInfo);
                
            } catch (error) {
                console.error('âŒ è¿æ¥æµ‹è¯•å¤±è´¥:', error);
                showResult('connection', false, null, {
                    message: error.message,
                    code: error.code,
                    status: error.response?.status,
                    statusText: error.response?.statusText
                });
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•è¿æ¥
        window.onload = function() {
            console.log('ğŸ“± é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨æµ‹è¯•...');
            testConnection();
        };
    </script>
</body>
</html> 