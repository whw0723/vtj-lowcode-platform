# 错误日志API集成说明

## 概述
已成功将 `x77mgb78.vue` 文件的错误日志页面对接到 `GetErrorLog` 接口。

## 接口信息
- **接口地址**: `/Manage/Log/GetErrorLog`
- **请求方式**: POST
- **目标服务器**: `http://192.168.80.79:8000`

## 实现的功能

### 1. API配置
- 使用 `axios` 直接调用API（参考成功案例）
- 配置了正确的请求头，包括：
  - `Content-Type: application/x-www-form-urlencoded; charset=UTF-8`
  - `Accept: application/json, text/javascript, */*; q=0.01`
  - `X-Requested-With: XMLHttpRequest`

### 2. Vue组件更新
- 导入了 `axios` 进行API调用
- 替换了模拟数据为真实API调用
- 添加了loading状态显示
- 配置了数据格式化处理
- 添加了错误处理和用户提示
- 添加了认证失败自动重试机制

### 3. 数据处理
- **分页**: 默认每页15条记录，支持10/20/50/100条切换
- **序号处理**: 使用计算后的序号显示正确的分页序号
- **字段映射**: 
  - `platform` → `systemName` (系统名称，通过堆栈跟踪智能提取)
  - `type` → `errorType` (错误类型)
  - `msg` → `errorMessage` (错误信息)
  - `leve1` → `errorLevel` (错误等级)
  - `update` → `occurTime` (发生时间)
  - `stacktrace` → `stackTrace` (堆栈跟踪)
  - `url` → 请求URL
  - `status` → 状态

### 4. 智能系统名称提取
实现了从堆栈跟踪中智能提取系统名称的功能：
- 优先提取Controller类名
- 其次提取其他类名
- 最后使用platform字段作为备选

### 5. 请求参数
```typescript
interface ErrorLogParams {
  page: number;        // 页码
  limit: number;       // 每页数量
}
```

### 6. 响应数据格式
```typescript
interface ErrorLogResponse {
  code: string;        // "0" 表示成功
  count: string;       // 总数量 "6673"
  data: ErrorLogData[]; // 错误日志数据数组
  msg: string;         // 响应消息 "成功"
}
```

### 7. 数据字段说明
根据接口响应，每条错误日志包含以下字段：
- `id`: 记录ID
- `platform`: 平台名称 (如 "log_sys", "2")
- `url`: 请求URL (如 "http://192.168.80.79:8000/Manage/User/GetUserName")
- `stacktrace`: 堆栈跟踪信息
- `type`: 错误类型 (如 "登录错误", "系统错误", "异常错误", "解析错误")
- `leve1`: 错误等级 (1-5，5为最严重)
- `msg`: 错误消息 (如 "登录错误", "RunState中出现错误")
- `status`: 状态 (通常为0)
- `update`: 发生时间 (如 "2022-06-21 14:09:49")
- `row`: 行号

## 功能特性

### 1. 分页功能
- 支持页码切换
- 支持每页条数切换 (10, 20, 50, 100)
- 显示总记录数
- 分页信息与API同步

### 2. 搜索功能
- 预留了系统名称搜索字段
- 预留了错误类型选择字段
- 预留了时间范围搜索字段
- 重置功能会清空搜索条件并重新加载数据

### 3. 数据展示
- 表格支持边框和斑马纹显示
- 错误类型使用不同颜色的标签显示
- 错误等级使用颜色标签显示（1-信息，2-调试，3-警告，4-错误，5-严重）
- 支持查看详情功能
- 加载状态显示
- 错误提示

### 4. 错误等级映射
- **1 (信息)**: 蓝色标签
- **2 (调试)**: 绿色标签
- **3 (警告)**: 黄色标签
- **4 (错误)**: 红色标签
- **5 (严重)**: 红色标签

### 5. 错误类型映射
- **登录错误**: 黄色标签
- **系统错误**: 红色标签
- **异常错误**: 红色标签
- **解析错误**: 黄色标签
- **操作错误**: 蓝色标签
- **网络错误**: 主色标签

### 6. 详情查看
- 点击"查看详情"按钮弹出对话框
- 显示完整的错误信息
- 包含堆栈跟踪的详细信息
- 使用描述列表组件展示

### 7. 错误处理
- API调用失败时显示错误消息
- 网络异常时的友好提示
- 控制台日志记录便于调试

## 代理配置
项目已配置代理，`/Manage` 路径会自动代理到目标服务器：
```typescript
'/Manage': {
  target: 'http://192.168.80.79:8000',
  changeOrigin: true,
  secure: false
}
```

## 使用说明

### 1. 页面加载
- 组件挂载时自动加载第一页数据
- 默认每页显示15条记录

### 2. 分页操作
- 点击页码切换页面
- 选择每页条数会重置到第一页

### 3. 搜索操作
- 点击"搜索"按钮执行搜索
- 点击"重置"按钮清空条件并重新加载

### 4. 详情查看
- 点击表格中的"查看详情"按钮
- 弹出对话框显示完整信息，包括堆栈跟踪

## 技术实现

### 1. API调用
使用 `axios` 直接调用API（参考成功案例）：
- 使用 `URLSearchParams` 构建表单数据
- 设置正确的请求头
- 支持认证失败自动重试
- 统一的错误处理

### 2. 认证机制
集成了项目的认证服务：
- 自动登录功能
- axios拦截器自动注入认证头
- 认证失败时自动重新登录并重试请求

### 3. 数据转换
将接口返回的原始数据转换为适合表格显示的格式：
- 计算分页序号
- 字段重命名和映射
- 数据类型转换
- 智能系统名称提取
- 错误等级文本转换

### 4. 状态管理
使用 Vue 3 的响应式API管理组件状态：
- `reactive` 管理搜索表单和分页信息
- `ref` 管理数据列表、加载状态和对话框状态

## 测试验证
- ✅ API调用成功
- ✅ 数据正确显示
- ✅ 分页功能正常
- ✅ 加载状态显示
- ✅ 错误处理有效
- ✅ 详情查看功能正常
- ✅ 错误等级和类型标签正确显示

## 后续扩展
1. 可以添加搜索功能的具体实现
2. 可以添加导出功能
3. 可以添加错误统计图表
4. 可以添加错误趋势分析
5. 可以添加错误分类统计
6. 可以添加自动刷新功能
