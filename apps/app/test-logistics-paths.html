<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©æµAPIè·¯å¾„æµ‹è¯•</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-item {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #409eff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #66b1ff;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #409eff;
        }
        .error {
            border-left-color: #f56c6c;
            background-color: #fef0f0;
        }
        .success {
            border-left-color: #67c23a;
            background-color: #f0f9ff;
        }
        pre {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ç‰©æµAPIè·¯å¾„æµ‹è¯•</h1>
        <p>æµ‹è¯•ä¸åŒçš„ç‰©æµAPIè·¯å¾„ï¼Œæ‰¾åˆ°æ­£ç¡®çš„æ¥å£åœ°å€</p>

        <div class="test-item">
            <h3>1. åŸå§‹è·¯å¾„</h3>
            <p><strong>è·¯å¾„:</strong> /Manage/Logistics/GetLogisticsToday</p>
            <button onclick="testPath('/Manage/Logistics/GetLogisticsToday')">æµ‹è¯•</button>
            <div id="result-1" class="result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>2. ç®€åŒ–è·¯å¾„</h3>
            <p><strong>è·¯å¾„:</strong> /Manage/Logistics/GetLogistics</p>
            <button onclick="testPath('/Manage/Logistics/GetLogistics')">æµ‹è¯•</button>
            <div id="result-2" class="result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>3. é€šç”¨ç‰©æµè·¯å¾„</h3>
            <p><strong>è·¯å¾„:</strong> /Manage/Logistics/GetData</p>
            <button onclick="testPath('/Manage/Logistics/GetData')">æµ‹è¯•</button>
            <div id="result-3" class="result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>4. ç‰©æµåˆ—è¡¨è·¯å¾„</h3>
            <p><strong>è·¯å¾„:</strong> /Manage/Logistics/GetList</p>
            <button onclick="testPath('/Manage/Logistics/GetList')">æµ‹è¯•</button>
            <div id="result-4" class="result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>5. ç‰©æµç®¡ç†è·¯å¾„</h3>
            <p><strong>è·¯å¾„:</strong> /Manage/Logistics/GetLogisticsData</p>
            <button onclick="testPath('/Manage/Logistics/GetLogisticsData')">æµ‹è¯•</button>
            <div id="result-5" class="result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>6. ç›´æ¥ç‰©æµè·¯å¾„</h3>
            <p><strong>è·¯å¾„:</strong> /Manage/GetLogistics</p>
            <button onclick="testPath('/Manage/GetLogistics')">æµ‹è¯•</button>
            <div id="result-6" class="result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>7. å¤„æ–¹ç‰©æµè·¯å¾„</h3>
            <p><strong>è·¯å¾„:</strong> /Manage/PreScription/GetLogistics</p>
            <button onclick="testPath('/Manage/PreScription/GetLogistics')">æµ‹è¯•</button>
            <div id="result-7" class="result" style="display: none;"></div>
        </div>

        <div class="test-item">
            <h3>8. æ‰¹é‡æµ‹è¯•</h3>
            <button onclick="testAllPaths()">æµ‹è¯•æ‰€æœ‰è·¯å¾„</button>
            <div id="result-all" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        // é…ç½®axios
        axios.defaults.withCredentials = true;
        axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';

        let testIndex = 0;

        async function testPath(path) {
            testIndex++;
            const resultId = `result-${testIndex > 7 ? 'all' : testIndex}`;
            const resultDiv = document.getElementById(resultId);
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<p>ğŸ”„ æ­£åœ¨æµ‹è¯•è·¯å¾„: ${path}</p>`;

            try {
                const params = new URLSearchParams({
                    page: '1',
                    limit: '10',
                    hospital: '0',
                    logisticsselect: '',
                    searchcontent: '',
                    logisticsptype: '',
                    quertime: '',
                    logistictime: '',
                    decmothed: '-1'
                });

                const response = await axios.post(path, params, {
                    timeout: 10000,
                    validateStatus: function (status) {
                        return status < 500; // åªæœ‰5xxé”™è¯¯æ‰ç®—å¤±è´¥
                    }
                });

                console.log(`âœ… è·¯å¾„ ${path} æµ‹è¯•æˆåŠŸ:`, response);

                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <p>âœ… <strong>æˆåŠŸ!</strong> çŠ¶æ€ç : ${response.status}</p>
                    <p><strong>è·¯å¾„:</strong> ${path}</p>
                    <p><strong>å“åº”æ•°æ®:</strong></p>
                    <pre>${JSON.stringify(response.data, null, 2)}</pre>
                `;

                // å¦‚æœæ‰¾åˆ°äº†æœ‰æ•ˆçš„æ•°æ®ï¼Œé«˜äº®æ˜¾ç¤º
                if (response.data && response.data.code === '0') {
                    resultDiv.style.borderLeftColor = '#67c23a';
                    resultDiv.style.backgroundColor = '#f0f9ff';
                }

            } catch (error) {
                console.error(`âŒ è·¯å¾„ ${path} æµ‹è¯•å¤±è´¥:`, error);

                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <p>âŒ <strong>å¤±è´¥!</strong> çŠ¶æ€ç : ${error.response?.status || 'N/A'}</p>
                    <p><strong>è·¯å¾„:</strong> ${path}</p>
                    <p><strong>é”™è¯¯ä¿¡æ¯:</strong> ${error.message}</p>
                    <p><strong>å“åº”æ•°æ®:</strong></p>
                    <pre>${JSON.stringify(error.response?.data || error.message, null, 2)}</pre>
                `;
            }
        }

        async function testAllPaths() {
            const paths = [
                '/Manage/Logistics/GetLogisticsToday',
                '/Manage/Logistics/GetLogistics',
                '/Manage/Logistics/GetData',
                '/Manage/Logistics/GetList',
                '/Manage/Logistics/GetLogisticsData',
                '/Manage/GetLogistics',
                '/Manage/PreScription/GetLogistics'
            ];

            const resultDiv = document.getElementById('result-all');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<p>ğŸ”„ æ­£åœ¨æ‰¹é‡æµ‹è¯•æ‰€æœ‰è·¯å¾„...</p>';

            let results = [];

            for (let i = 0; i < paths.length; i++) {
                const path = paths[i];
                try {
                    const params = new URLSearchParams({
                        page: '1',
                        limit: '10',
                        hospital: '0',
                        logisticsselect: '',
                        searchcontent: '',
                        logisticsptype: '',
                        quertime: '',
                        logistictime: '',
                        decmothed: '-1'
                    });

                    const response = await axios.post(path, params, {
                        timeout: 5000,
                        validateStatus: function (status) {
                            return status < 500;
                        }
                    });

                    results.push({
                        path,
                        status: response.status,
                        success: true,
                        data: response.data,
                        hasValidData: response.data && response.data.code === '0'
                    });

                } catch (error) {
                    results.push({
                        path,
                        status: error.response?.status || 'N/A',
                        success: false,
                        error: error.message,
                        data: error.response?.data
                    });
                }
            }

            // æ˜¾ç¤ºç»“æœ
            let html = '<h4>æ‰¹é‡æµ‹è¯•ç»“æœ:</h4>';
            results.forEach((result, index) => {
                const statusClass = result.success ? 'success' : 'error';
                const statusIcon = result.success ? 'âœ…' : 'âŒ';
                const validDataIcon = result.hasValidData ? 'ğŸ¯' : '';
                
                html += `
                    <div style="margin-bottom: 10px; padding: 10px; border-left: 4px solid ${result.success ? '#67c23a' : '#f56c6c'}; background-color: ${result.success ? '#f0f9ff' : '#fef0f0'};">
                        <strong>${statusIcon} ${validDataIcon} è·¯å¾„ ${index + 1}:</strong> ${result.path}<br>
                        <strong>çŠ¶æ€ç :</strong> ${result.status}<br>
                        ${result.hasValidData ? '<strong>ğŸ¯ åŒ…å«æœ‰æ•ˆæ•°æ®!</strong><br>' : ''}
                        ${result.success ? `<strong>å“åº”:</strong> ${JSON.stringify(result.data).substring(0, 100)}...` : `<strong>é”™è¯¯:</strong> ${result.error}`}
                    </div>
                `;
            });

            resultDiv.innerHTML = html;

            // æ‰¾åˆ°æœ‰æ•ˆçš„è·¯å¾„
            const validPaths = results.filter(r => r.hasValidData);
            if (validPaths.length > 0) {
                html += `<div style="margin-top: 20px; padding: 15px; background-color: #e6f7ff; border-left: 4px solid #1890ff; border-radius: 4px;">
                    <h4>ğŸ¯ æ‰¾åˆ°æœ‰æ•ˆè·¯å¾„:</h4>
                    ${validPaths.map(p => `<p><strong>${p.path}</strong></p>`).join('')}
                </div>`;
                resultDiv.innerHTML = html;
            }
        }

        // é‡ç½®æµ‹è¯•ç´¢å¼•
        function resetTestIndex() {
            testIndex = 0;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•ç¬¬ä¸€ä¸ªè·¯å¾„
        window.onload = function() {
            console.log('ğŸ“± é¡µé¢åŠ è½½å®Œæˆ');
            resetTestIndex();
        };
    </script>
</body>
</html>
